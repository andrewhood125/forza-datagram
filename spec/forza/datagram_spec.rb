require 'json'

RSpec.describe Forza::Datagram do
  it "has a version number" do
    expect(Forza::Datagram::VERSION).not_to be nil
  end

  let(:datagram) { "\x01\x00\x00\x00S\xEDm\x0E\xF8\xBF\xDAE\xF8\xFFGD\x9E\x01HD\x8E!i\xBC\xBA\x8B(:Ut\x9F\xBA\x80K\x8D\xBB\x0F\xCF\x8D;\"h.@\xE6\xFEV\xBB1\xA6R\xBBT\xA7\x8B\xB9\x11\x1D\xBB?\x11O\xBA\xB8\xC1k\xA8:Q\xE3\b?\xCB\xD8\b?\a\xBA\b?\x06\xFC\a?\x90\xE7q6\x13\xA6\x116\xC6\x98\xB89\x9B\xF0\x969U\xD3\x05A\x17\x12\x06A\xFA\xD7\x05AS\x16\x06A\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00W\xFC\x83\xB8\xFD\xE2\xC5\xB9i\xD8@\xBAw)>\xBA\x17\xB7\xD18\xD3\xE3\xC59\x88\xCBU:-\x97L:\x00h\xA59\x00V\x9A9\x00\xF0s9\x00\xD4\e\xB9\x15\x04\x00\x00\x01\x00\x00\x00N\x01\x00\x00\x01\x00\x00\x00\b\x00\x00\x00" }
  let(:expected_datagram) { "{\"is_race_on\":1,\"timestamp\":242085203,\"engine_max_rpm\":6999.99609375,\"engine_idle_rpm\":799.99951171875,\"current_engine_rpm\":800.0252685546875,\"acceleration_x\":-0.014229191467165947,\"acceleration_y\":0.0006429512286558747,\"acceleration_z\":-0.001216540695168078,\"velocity_x\":-0.004311978816986084,\"velocity_y\":0.004327661823481321,\"velocity_z\":2.7251057624816895,\"angular_velocity_x\":-0.0032805739901959896,\"angular_velocity_y\":-0.003214251482859254,\"angular_velocity_z\":-0.00026636815164238214,\"yaw\":1.4618245363235474,\"pitch\":-8.883898408384994e-05,\"roll\":0.001284949597902596,\"normalized_suspension_travel_front_left\":0.5347185730934143,\"normalized_suspension_travel_front_right\":0.5345579981803894,\"normalized_suspension_travel_rear_left\":0.5340885519981384,\"normalized_suspension_travel_rear_right\":0.5311893224716187,\"tire_slip_ratio_front_left\":3.60465855919756e-06,\"tire_slip_ratio_front_right\":2.170335164919379e-06,\"tire_slip_ratio_rear_left\":0.00035209039924666286,\"tire_slip_ratio_rear_right\":0.0002878949453588575,\"wheel_rotation_speed_front_left\":8.364094734191895,\"wheel_rotation_speed_front_right\":8.379416465759277,\"wheel_rotation_speed_rear_left\":8.365228652954102,\"wheel_rotation_speed_rear_right\":8.380450248718262,\"wheel_on_rumble_strip_front_left\":0,\"wheel_on_rumble_strip_front_right\":0,\"wheel_on_rumble_strip_rear_left\":0,\"wheel_on_rumble_strip_rear_right\":0,\"wheel_in_puddle_depth_front_left\":0.0,\"wheel_in_puddle_depth_front_right\":0.0,\"wheel_in_puddle_depth_rear_left\":0.0,\"wheel_in_puddle_depth_rear_right\":0.0,\"surface_rumble_front_left\":0.0,\"surface_rumble_front_right\":0.0,\"surface_rumble_rear_left\":0.0,\"surface_rumble_rear_right\":0.0,\"tire_slip_angle_front_left\":-6.293568731052801e-05,\"tire_slip_angle_front_right\":-0.00037743887514807284,\"tire_slip_angle_rear_left\":-0.000735646637622267,\"tire_slip_angle_rear_right\":-0.0007254103547893465,\"tire_combined_slip_front_left\":9.999999747378752e-05,\"tire_combined_slip_front_right\":0.0003774451033677906,\"tire_combined_slip_rear_left\":0.0008155633695423603,\"tire_combined_slip_rear_right\":0.0007804509368725121,\"suspension_travel_meters_front_left\":0.0003154873847961426,\"suspension_travel_meters_front_right\":0.00029437243938446045,\"suspension_travel_meters_rear_left\":0.0002326369285583496,\"suspension_travel_meters_rear_right\":-0.00014860928058624268,\"car_ordinal\":1045,\"car_class\":1,\"car_performance_index\":334,\"drivetrain_type\":1,\"num_cylinders\":8}" }
  it "decodes a forza datagram" do
    expect(Forza::Datagram.decode(datagram)).to eq(JSON.parse(expected_datagram, symbolize_names: true))
  end
end
